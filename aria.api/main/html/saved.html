<div class="myDiv" id="div3">
    <div class="clearTop"></div>
    <div class="title">
        <span class="first">aria</span>
        <span class="second">.saved()</span>
    </div>
    <div class="description">
        <p>/ˈkæpʧəd ˈrɛvəriz/</p>
    </div>
    <div class="description2">
        <span>Here you can revisit <br>
        that which you sought.</span>
    </div>
    <div class="saved-container">
        <table id="dataTable1" class="tableFavorite">
            <caption>&#60;favorites&#62;</caption>
            <tr>
                <th class="table_heading date">.date_added:</th>
                <th class="table_heading artist">.song_artist:</th>
                <th class="table_heading name">.song_title:</th>
                <th class="table_heading buttons"><span></span></th>
            </tr>
        </table>
        <table id="dataTable2" class="tableHistory">
            <caption>&#60;search_history&#62;</caption>
            <tr>
                <th class="table_heading date">.date_searched:</th>
                <th class="table_heading artist">.song_artist:</th>
                <th class="table_heading name">.song_title:</th>
                <th class="table_heading buttons"><span></span></th>
            </tr>
        </table>
    </div>
</div>

<script>

    $(function() {

        $.post("http://localhost:8081/saved").then((jsonData) => {
            const data = JSON.parse(jsonData);

            let favoriteObject = data;

            for (let i = 0; i < favoriteObject.length; i++) {
                $('#dataTable1').append('<tr class="table_row">\n' +
                    '                <td class="table_content date" tableId="date">' + favoriteObject[i].aika + '</td>\n' +
                    '                <td class="table_content artist" tableId="artist">' + favoriteObject[i].artist + '</td>\n' +
                    '                <td class="table_content name" tableId="name">' + favoriteObject[i].song + '</td>\n' +
                    '                <td class="table_content buttons">\n' +
                    '                    <button type="button" buttonId="expand" class="customButton4">\n' +
                    '                        <span class="gg-eye"></span>\n' +
                    '                    </button>\n' +
                    '                    <button type="button" buttonId="remove1" class="customButton5">\n' +
                    '                        <span class="gg-close"></span>\n' +
                    '                    </button>\n' +
                    '                </td>\n' +
                    '            </tr>');
            }

            $.post("http://localhost:8081/history").then((jsonData) => {
                const data = JSON.parse(jsonData);
                let historyObject = data;

                for (let i = 0; i < historyObject.length; i++) {
                    $('#dataTable2').append('<tr class="table_row">\n' +
                        '                <td class="table_content date" tableId="date">' + historyObject[i].aikaHis + '</td>\n' +
                        '                <td class="table_content artist" tableId="artist">' + historyObject[i].artistHis + '</td>\n' +
                        '                <td class="table_content name" tableId="name">' + historyObject[i].songHis + '</td>\n' +
                        '                <td class="table_content buttons">\n' +
                        '                    <button type="button" buttonId="expand" class="customButton4">\n' +
                        '                        <span class="gg-eye"></span>\n' +
                        '                    </button>\n' +
                        '                    <button type="button" buttonId="remove2" class="customButton5">\n' +
                        '                        <span class="gg-close"></span>\n' +
                        '                    </button>\n' +
                        '                </td>\n' +
                        '            </tr>');
                }

                $("button[buttonId^='remove2']").on("click", function (e) {
                    e.preventDefault();

                    let date = $(this).closest('.table_row').find('td[tableId="date"]').html();

                    $(this).closest('.table_row').remove();

                    $.post("http://localhost:8081/delete/history",
                        {
                            'date': date
                        })

                });

                $("button[buttonId^='expand']").on("click", function () {

                    let artist = $(this).closest('.table_row').find('td[tableId="artist"]').html();
                    let title = $(this).closest('.table_row').find('td[tableId="name"]').html();

                    $.post("http://localhost:8081/trace",
                        {
                            'artist': artist,
                            'title': title
                        },
                        function (jsonData) {
                            const data = JSON.parse(jsonData);

                            $(".lyrics").scrambler({
                                effect: "charbychar",
                                final_text: data.songLyrics,
                                speed: 1,
                                reveal: 1
                            }).removeClass(" alignText");

                            console.log("Acquiring of data successful");
                            $(".cover").fadeOut();
                            setTimeout(function () {
                                $(".cover").attr("src", data.albumArt).fadeIn();
                            }, 500);

                            $(".songTitle2").html(data.songFullTitle);
                            $(".songArtists2").html(data.artistsList.join(", "));
                            $(".songAlbum2").html(data.albumName);
                            $(".songDate2").html(data.releaseDate);
                            $(".songProducers2").html(data.producerList.join(", "));
                        });

                    History.pushState({path: 'trace'}, 'trace', './trace');

                    $.ajax({
                        type: 'GET',
                        url: '../html/trace.html',
                        dataType: 'html',
                        success: function (result) {
                            setTimeout(function () {
                                $( ".main" ).empty();
                                $('.main').html(result)
                            }, 500);
                        }
                    });
                });
            });

            $("button[buttonId^='remove1']").on("click", function (e) {
                e.preventDefault();

                let songTitle = $(this).closest('.table_row').find('td[tableId="name"]').html();
                let date = $(this).closest('.table_row').find('td[tableId="date"]').html();

                $(this).closest('.table_row').remove();

                $.post("http://localhost:8081/delete",
                    {
                        'title': songTitle,
                        'date': date
                    })
            });
        });
    });
</script>

<!-------------------------------------SCRAMBLE-EFFECT------------------------------------->
<script>
    ;(function($) {

        $.scrambler = function(element, options) {

            var plugin = this;
            plugin.settings = {};

            var $element = $(element),
                element = element;

            var defaults = {
                effect : "charbychar", // 2 options - charbychar and typing
                keep_whitespaces : true, // true: keep whitespaces, false: fill whitespaces with a random character
                speed : 100,
                duration : 3000,
                final_text: $element.text(),
                reveal: 1000, // number of milliseconds
                total_iterations : 0,
                interval : -1
            }

            plugin.init = function() {
                plugin.settings = $.extend({}, defaults, options);
                var el = $element;
                var str = plugin.settings.final_text;

                if (plugin.settings.effect == "charbychar" || plugin.settings.effect == "typing"){
                    var pos_limit = 0;                                             // randomize text from this position to the end
                    var pos_total = str.length;
                    var internal_char_reveal_counter = 0;
                    plugin.settings.duration = pos_total * plugin.settings.reveal; // calculating duration with reveal

                    plugin.settings.interval = setInterval( function(){

                        // changing text character by character effect
                        el.text( scrambler_char_by_char( str, pos_limit, plugin.settings.effect) );

                        plugin.settings.total_iterations += plugin.settings.speed;
                        internal_char_reveal_counter += plugin.settings.speed;

                        // reset to wait for the next reveal and fix the character limit
                        if (internal_char_reveal_counter >= plugin.settings.reveal){
                            internal_char_reveal_counter = 0;
                            pos_limit++;
                        }

                        // end and stop interval
                        if ( plugin.settings.total_iterations >= plugin.settings.duration ) {
                            clearInterval(plugin.settings.interval);
                            plugin.settings.total_iterations = 0;
                            plugin.settings.interval = -1;
                            el.text(str);
                        }
                    }, plugin.settings.speed );
                }
            }


            /* get a random character between two limits */

            var scramble_get_random_char = function (max, min){
                var random = Math.floor(Math.random() * (max - min + 1) + min);
                return String.fromCharCode(random);
            }

            /* scramble and reveal characters one by one */

            var scrambler_char_by_char = function(s, poslimit, effect){
                var ret_string = "";
                var fixed_chars = s.substr(0, poslimit);

                for (var c = poslimit; c < s.length; c++){
                    if ( s.charCodeAt(c) == 32 && plugin.settings.keep_whitespaces ){
                        ret_string += " ";
                    }else{
                        ret_string += scramble_get_random_char(33, 126);
                    }
                }
                if (effect == "typing") ret_string = "|";
                return fixed_chars + ret_string;
            }
            plugin.init();
        }

        $.fn.scrambler = function(options) {
            return this.each(function() {
                var plugin = new $.scrambler(this, options);
                $(this).data('scrambler', plugin);
            });
        }
    })(jQuery);
</script>

